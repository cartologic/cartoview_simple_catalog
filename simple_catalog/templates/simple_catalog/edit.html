{% extends "cartoview/base.html" %}

{% block title %} {{ catalog.title }} â€” {{ block.super }} {% endblock %}
{% block styles %}
    <style>
    .keywords-select-header {
    }
  .keywords-select-header .keywords-header-searchbox {
    border: none;
    outline: none;
    height: 100%;
    width: 100%;
    padding: 0;
  }
  .keywords-select-header .keywords-select-header {
    box-shadow: 0 1px 0 0 rgba(0, 0, 0, 0.1), 0 0 0 0 rgba(0, 0, 0, 0.14), 0 0 0 0 rgba(0, 0, 0, 0.12);
    padding-left: 10.667px;
    height: 48px;
    cursor: pointer;
    position: relative;
    display: flex;
    align-items: center;
    width: auto;
  }
  .keywords-select-header md-content._md {
    max-height: 240px; 
  }

    md-tabs {
      background: #f6f6f6;
      border: 1px solid #e1e1e1;
    }

    md-tabs md-tabs-wrapper {
      background: white;
    }

    .md-tab md-icon {
        visibility: hidden;
    }
    .md-tab.md-active md-icon {
        visibility: visible;
    }

    .md-chips .md-chip{
        height: 60px;
        border-radius: 0;
        padding: 0 0;
    }
    span.item-title{
        padding: 0px 10px;
    }
    span.item-type{
        position: absolute;
        text-transform: uppercase;
        background-color: #444;
        color: #fff;
        bottom: 0;
        left: 0;
        padding: 2px;
        font-size: 10px;
        font-weight: bold;
        display: inline-block;
        line-height: 10px;
    }
    img.item-img{
        height: 60px;
    }
    .md-chips .md-chip-input-container md-autocomplete{
        min-width:400px;
    }
    .item-tpl{
        position: relative;
    }

.autocomplete-resources-list.md-autocomplete-suggestions li {
    /* font-size: 14px; */
    overflow: hidden;
    padding: 0 15px;
    /* line-height: 48px; */
    height: 48px;
    /* transition: background .15s linear; */
    /* margin: 10px 0; */
    /* white-space: nowrap; */
    /* text-overflow: ellipsis; */
    height: 61px;
}
{#    .autocomplete-resources-list .item-tpl{#}
{#        margin: 5px 0;#}
{#    }#}
    </style>
    <link rel="stylesheet" href="{{ STATIC_URL }}simple_catalog/css/main.css">
{% endblock %}

{% block scripts %}
    <script type="text/javascript" src="{{ STATIC_URL }}vendor/angular-resource.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}cartoview/js/appinstance-service.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}simple_catalog/js/catalog.js"></script>
    <script type="text/javascript">
        var catalogEditApp = angular.module('catalogEditApp', ['cartoview.base', 'cartoview.appInstances', 'cartoview.catalog']);
        catalogEditApp.constant('catalogId', {{ catalog_id }});
    </script>
<script type="text/javascript" src="{{ STATIC_URL }}simple_catalog/js/edit-controller.js"></script>
{% endblock %}
{% block body_directives %}ng-app="catalogEditApp" ng-controller="catalogEditController"{% endblock %}
{% block body %}
<div layout-align="center center"
     layout="row">
    <div flex="100"  flex-gt-md="80" layout="column" class="md-padding">
        <h2>Create Your Simple Catalog</h2>
        <md-input-container>
            <label>Title</label>
            <input ng-model="catalog.title" placeholder="Catalog Title" name="title">
        </md-input-container>
        <md-input-container>
            <label>Abstract</label>
            <textarea  ng-model="catalog.abstract" placeholder="Catalog Abstract" name="abstract"></textarea>
        </md-input-container>
        <h4>Select Catalog Items By:</h4>
        <md-tabs  md-dynamic-height md-border-bottom md-autoselect md-selected="selectedTab">
            <md-tab>
                <md-tab-label>
                    <md-icon>done</md-icon>
                    <span>Dynamic Filter</span>
                </md-tab-label>
                <md-tab-body>
                    <div layout="column" class="md-padding">
                        <md-checkbox ng-model="configObj.layers"> Layers</md-checkbox>
                        <md-checkbox ng-model="configObj.maps"> Maps</md-checkbox>
                        <md-checkbox ng-model="configObj.apps">Apps</md-checkbox>
                        <md-checkbox ng-model="configObj.documents">Documents</md-checkbox>
                        <md-checkbox ng-model="configObj.featured">Featured</md-checkbox>
                        <md-input-container>
                            <label>Keywords</label>
                            <md-select ng-model="configObj.keywords"
                                md-on-close="clearKeywordsSearch()"
                                data-md-container-class="keywords-select-header"
                                multiple>
                                <md-select-header class="keywords-select-header">
                                    <input ng-model="keywordSearchTerm"
                                        type="search"
                                        placeholder="Search for a keyword.."
                                        class="keywords-header-searchbox _md-text">
                                </md-select-header>
                                <md-optgroup label="Keywords">
                                    {% verbatim %}
                                    <md-option ng-value="keyword.id" ng-repeat="keyword in keywords | filter:keywordSearchTerm">{{keyword.name}}</md-option>
                                    {% endverbatim %}
                                </md-optgroup>
                            </md-select>
                        </md-input-container>
                    </div>
                </md-tab-body>
            </md-tab>
            <md-tab>
                <md-tab-label>
                    <md-icon>done</md-icon>
                    <span>One By One</span>
                </md-tab-label>
                <md-tab-body>
{#                <catalog template="selector" all-resources#}
{#                 {% if catalog_id != 'null' %}catalog-id="{{ catalog_id }}"{% endif %}></catalog>#}



                    <md-chips ng-model="autocomplete.selectedItems" md-autocomplete-snap
                              md-transform-chip="transformChip($chip)"
                              md-require-match="true">
                        <md-autocomplete
                                md-selected-item="autocomplete.selectedItem"
                                md-search-text="autocomplete.text"
                                md-no-cache="true"
                                md-items="item in loadAutocomplete()"
                                md-item-text="item.title"
                                md-min-length="0"
                                md-menu-class="autocomplete-resources-list"
                                placeholder="Add items here">
                            {% verbatim %}
                            <md-item-template>
                                <div layout="row" layout-align="start center"
                                     class="item-tpl" ng-class="{selected:itemSelected(item)}">
                                    <img class="item-img" ng-src="{{ item.thumbnail }}">
                                    <span class="item-title">{{item.title}}</span>
                                    <span class="item-type">{{item.type}}</span>
                                </div>
                                <md-divider></md-divider>
                            </md-item-template>
                            <span md-highlight-text="autocomplete.text">{{item.title}}</span>
                            {% endverbatim %}
                        </md-autocomplete>
                        <md-chip-template>
                            <div layout="row" layout-align="center center" class="item-tpl">
                                {% verbatim %}
                                <img class="item-img" ng-src="{{ $chip.thumbnail }}">
                                <span class="item-title">{{$chip.title}}</span>
                                <span class="item-type">{{$chip.type}}</span>
                                {% endverbatim %}
                            </div>
                        </md-chip-template>
                    </md-chips>
                </md-tab-body>
            </md-tab>
        </md-tabs>
        <div class="md-padding"></div>
        <md-checkbox ng-model="configObj.enablePaging">Enable Paging</md-checkbox>
        <md-input-container ng-show="configObj.enablePaging">
            <label>Items per page</label>
            <input ng-model="configObj.itemsPerPage" placeholder="Items per page" type="number" min="1" max="100" step="1">
        </md-input-container>
        <md-checkbox ng-model="configObj.enableSearch">Enable Search</md-checkbox>
        <div layout="row">
            <md-button  class="md-raised md-primary" ng-click="save()">Save</md-button>
            {% if catalog_id != 'null' %}
                <md-button  class="md-raised" href="{% url 'appinstance_detail' catalog_id %}">Details</md-button>
                <md-button  class="md-raised" href="{% url 'simple_catalog.view' catalog_id %}">View</md-button>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
